# üì± –†–µ–∫–ª–∞–º–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞

## üìë –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [‚ö°Ô∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è](#-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
- [üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É](#-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è-–ø–æ-–∑–∞–ø—É—Å–∫—É)
- [üìñ API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](#-api-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)
- [üìä –°—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö](#-—Å—Ö–µ–º—ã-–¥–∞–Ω–Ω—ã—Ö)
   - [üêò Postgres](#-postgres)
   - [üê≥ ClickHouse](#-clickhouse)
- [üéÆ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã](#-–¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è-—Ä–∞–±–æ—Ç—ã)
   - [API](#1-api-httplocalhost8080)
   - [Grafana](#2-grafana-httplocalhost3000)
   - [MinIO](#3-minio-httplocalhost9001)
- [üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- [‚öôÔ∏è –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã](#-–ø—Ä–∏–Ω—Ü–∏–ø-—Ä–∞–±–æ—Ç—ã)
   - [–ü–æ–¥–±–æ—Ä —Ä–µ–∫–ª–∞–º—ã](#–ø–æ–¥–±–æ—Ä-—Ä–µ–∫–ª–∞–º—ã)
   - [–°–∫–æ—Ä–∏–Ω–≥ —Ä–µ–∫–ª–∞–º—ã](#—Å–∫–æ—Ä–∏–Ω–≥-—Ä–µ–∫–ª–∞–º—ã)
   - [Threshold](#threshold)
  - [–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è](#–∑–∞–≥—Ä—É–∑–∫–∞-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)
  - [–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ](#–∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ)
  - [–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞](#–≥–µ–Ω–µ—Ä–∞—Ü–∏—è-—Ç–µ–∫—Å—Ç–∞-–¥–ª—è-—Ä–µ–∫–ª–∞–º–Ω—ã—Ö-–∫–∞–º–ø–∞–Ω–∏–π)
- [–ó–∞–º–µ—Ç–∫–∞](#note)

## ‚ö°Ô∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- üê≥ Docker –∏ Docker Compose
- üîÑ Git
- üîì –ü–æ—Ä—Ç—ã `8080, 3000, 5432, 6380, 8123, 9000, 9001, 9002` –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–≤–æ–±–æ–¥–Ω—ã

## üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git clone https://gitlab.prodcontest.ru/2025-final-projects-back/nlypage.git
```

```bash
cd nlypage/solution
```

```bash
docker compose up --build
```

### ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

- –í —Ñ–∞–π–ª–µ `.env` –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –æ–∫—Ä—É–∂–µ–Ω–∏–µ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º–æ–µ –≤ docker compose
- –í —Ñ–∞–π–ª–µ `/advertising/config.yaml` –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Advertising-—Å–µ—Ä–≤–∏—Å–∞

## üìö API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–ª–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è API –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ OpenAPI: [openapi.yaml](./openapi.yaml)

### üîó –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

1. **üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞–º–∏**

   ```http
   GET    /clients/{clientId}      # –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ ID
   POST   /clients/bulk            # –ú–∞—Å—Å–æ–≤–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤
   ```

2. **üíº –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∫–ª–∞–º–æ–¥–∞—Ç–µ–ª—è–º–∏**

   ```http
   GET    /advertisers/{advertiserId}                    # –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∫–ª–∞–º–æ–¥–∞—Ç–µ–ª—è
   POST   /advertisers/bulk                             # –ú–∞—Å—Å–æ–≤–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
   POST   /ml-scores                                    # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ ML —Å–∫–æ—Ä–∞
   ```

3. **üì¢ –†–µ–∫–ª–∞–º–Ω—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏**

   ```http
   POST   /advertisers/{advertiserId}/campaigns         # –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏–∏
   GET    /advertisers/{advertiserId}/campaigns         # –°–ø–∏—Å–æ–∫ –∫–∞–º–ø–∞–Ω–∏–π
   GET    /advertisers/{advertiserId}/campaigns/{id}    # –î–µ—Ç–∞–ª–∏ –∫–∞–º–ø–∞–Ω–∏–∏
   ```

4. **üìä –ü–æ–∫–∞–∑ —Ä–µ–∫–ª–∞–º—ã –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**

   ```http
   GET    /ads                                             # –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∫–ª–∞–º—ã
   POST   /ads/{adId}/click                                # –§–∏–∫—Å–∞—Ü–∏—è –∫–ª–∏–∫–∞
   GET    /stats/advertisers/{id}/campaigns/daily          # –î–Ω–µ–≤–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
   ```

### üí° –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

1. **–°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞**

   `POST /clients/bulk`

   ```json
   [
   	{
   		"client_id": "uuid",
   		"login": "user123",
   		"age": 25,
   		"location": "Moscow",
   		"gender": "MALE"
   	}
   ]
   ```

2. **–°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∫–ª–∞–º–Ω–æ–π –∫–∞–º–ø–∞–Ω–∏–∏**

   `POST /advertisers/{advertiserId}/campaigns`

   ```json
   {
   	"impressions_limit": 10000,
   	"clicks_limit": 1000,
   	"cost_per_impression": 0.1,
   	"cost_per_click": 1.0,
   	"ad_title": "–õ–µ—Ç–Ω—è—è —Ä–∞—Å–ø—Ä–æ–¥–∞–∂–∞",
   	"ad_text": "–°–∫–∏–¥–∫–∏ –¥–æ 70% –Ω–∞ –ª–µ—Ç–Ω—é—é –∫–æ–ª–ª–µ–∫—Ü–∏—é",
   	"start_date": 1,
   	"end_date": 30,
   	"targeting": {
   		"gender": "FEMALE",
   		"age_from": 18,
   		"age_to": 35,
   		"location": "Moscow"
   	}
   }
   ```

3. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ ML —Å–∫–æ—Ä–∞**

   `POST /ml-scores`

   ```json
   {
   	"client_id": "uuid-client",
   	"advertiser_id": "uuid-advertiser",
   	"score": 850
   }
   ```

## üìä –°—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö

### üêò Postgres

```mermaid
classDiagram
   direction BT
%% –¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∫–ª–∞–º–æ–¥–∞—Ç–µ–ª–µ–π
   class advertisers {
      varchar name "–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ —Ä–µ–∫–ª–∞–º–æ–¥–∞—Ç–µ–ª—è"
      uuid id "–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä"
   }

%% –¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π
   class campaigns {
      uuid advertiser_id "–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ä–µ–∫–ª–∞–º–æ–¥–∞—Ç–µ–ª—è"
      bigint impressions_limit "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–∫–∞–∑–æ–≤"
      bigint clicks_limit "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–∫–æ–≤"
      double precision cost_per_impression "–°—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞ –ø–æ–∫–∞–∑"
      double precision cost_per_click "–°—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞ –∫–ª–∏–∫"
      varchar ad_title "–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ä–µ–∫–ª–∞–º—ã"
      varchar ad_text "–¢–µ–∫—Å—Ç —Ä–µ–∫–ª–∞–º—ã"
      bigint start_date "–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –∫–∞–º–ø–∞–Ω–∏–∏"
      bigint end_date "–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∫–∞–º–ø–∞–Ω–∏–∏"
      boolean moderated "–§–ª–∞–≥ –º–æ–¥–µ—Ä–∞—Ü–∏–∏"
      varchar image_url "–°—Å—ã–ª–∫–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ MinIO"
      uuid id "–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä"
   }

%% –¢–∞–±–ª–∏—Ü–∞ ML-—Å–∫–æ—Ä–æ–≤
   class ml_scores {
      bigint score "–û—Ü–µ–Ω–∫–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏"
      uuid user_id "–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
      uuid advertiser_id "–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ä–µ–∫–ª–∞–º–æ–¥–∞—Ç–µ–ª—è"
      bigint id "–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä"
   }

%% –¢–∞–±–ª–∏—Ü–∞ —Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥–æ–≤
   class targetings {
      varchar gender "–ü–æ–ª —Ü–µ–ª–µ–≤–æ–π –∞—É–¥–∏—Ç–æ—Ä–∏–∏"
      bigint age_from "–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –≤–æ–∑—Ä–∞—Å—Ç"
      bigint age_to "–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –≤–æ–∑—Ä–∞—Å—Ç"
      varchar location "–ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ"
      uuid campaign_targeting "–°–≤—è–∑—å —Å —Ä–µ–∫–ª–∞–º–Ω–æ–π –∫–∞–º–ø–∞–Ω–∏–µ–π"
      bigint id "–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä"
   }

%% –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   class users {
      varchar login "–õ–æ–≥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
      bigint age "–í–æ–∑—Ä–∞—Å—Ç"
      varchar location "–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ"
      varchar gender "–ü–æ–ª"
      uuid id "–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä"
   }

   campaigns --> advertisers: advertiser_id -> id
   ml_scores --> advertisers: advertiser_id -> id
   ml_scores --> users: user_id -> id
   targetings --> campaigns: campaign_targeting -> id
```

### üìà ClickHouse

```mermaid
classDiagram
   direction BT
%% –¢–∞–±–ª–∏—Ü–∞ –∫–ª–∏–∫–æ–≤ –ø–æ —Ä–µ–∫–ª–∞–º–µ
   class ad_clicks {
      uuid campaign_id "ID —Ä–µ–∫–ª–∞–º–Ω–æ–π –∫–∞–º–ø–∞–Ω–∏–∏"
      uuid advertiser_id "ID —Ä–µ–∫–ª–∞–º–æ–¥–∞—Ç–µ–ª—è"
      uuid client_id "ID –∫–ª–∏–µ–Ω—Ç–∞"
      float64 income "–î–æ—Ö–æ–¥ –æ—Ç –∫–ª–∏–∫–∞"
      int32 day "–î–µ–Ω—å —Å–æ–±—ã—Ç–∏—è"
   }
%% –¢–∞–±–ª–∏—Ü–∞ –ø–æ–∫–∞–∑–æ–≤ —Ä–µ–∫–ª–∞–º—ã
   class ad_impressions {
      uuid campaign_id "ID —Ä–µ–∫–ª–∞–º–Ω–æ–π –∫–∞–º–ø–∞–Ω–∏–∏"
      uuid advertiser_id "ID —Ä–µ–∫–ª–∞–º–æ–¥–∞—Ç–µ–ª—è"
      uuid client_id "ID –∫–ª–∏–µ–Ω—Ç–∞"
      float64 income "–î–æ—Ö–æ–¥ –æ—Ç –ø–æ–∫–∞–∑–∞"
      int32 day "–î–µ–Ω—å —Å–æ–±—ã—Ç–∏—è"
      uint32 view_count "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–∫–∞–∑–æ–≤"
   }
```

## üéÆ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã

### 1. API (<http://localhost:8080>)

#### –û—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

1. **–†–µ–∫–ª–∞–º–Ω—ã–µ –∫–∞–º–ø–∞–Ω–∏–∏**

   - –°–æ–∑–¥–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏—è–º–∏
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥–∞

2. **–ü–æ–∫–∞–∑ —Ä–µ–∫–ª–∞–º—ã**

   - –£–º–Ω—ã–π –ø–æ–¥–±–æ—Ä –æ–±—ä—è–≤–ª–µ–Ω–∏–π
   - –£—á–µ—Ç —Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥–∞
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

3. **–ú–æ–¥–µ—Ä–∞—Ü–∏—è**

   - –†—É—á–Ω–∞—è –º–æ–¥–µ—Ä–∞—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

4. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞**
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞–º–ø–∞–Ω–∏—è–º
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ä–µ–∫–ª–∞–º–æ–¥–∞—Ç–µ–ª—è–º

–ë–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ [API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏](#-api-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)

### 2. Grafana (<http://localhost:3000>)

#### –î–æ—Å—Ç—É–ø

- **–õ–æ–≥–∏–Ω**: `admin`
- **–ü–∞—Ä–æ–ª—å**: `password`

#### –ì—Ä–∞—Ñ–∏–∫–∏

1. **–ü–æ–¥–Ω–µ–≤–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–∫–æ–≤**

    - XY chart
    - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–∫–æ–≤ –≤ –¥–µ–Ω—å

2. **–ü–æ–¥–Ω–µ–≤–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–∫–∞–∑–æ–≤**

    - XY chart
    - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–∫–∞–∑–æ–≤ –≤ –¥–µ–Ω—å

3. **–ü—Ä–∏–±—ã–ª—å –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã**

    - Bar chart
    - –ü–æ–¥–Ω–µ–≤–Ω–∞—è —Å—É–º–º–∞—Ä–Ω–∞—è –ø–∏–±—ã–ª—å
    - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–∫–∞–∑–æ–≤ –≤ –¥–µ–Ω—å
    - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–∫–æ–≤ –≤ –¥–µ–Ω—å

![img.png](img/grafana.png)

### 3. MinIO (<http://localhost:9001>)

#### –î–æ—Å—Ç—É–ø

- **–õ–æ–≥–∏–Ω**: `root`
- **–ü–∞—Ä–æ–ª—å**: `password`

#### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –•—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ–¥–∏–∞-–∫–æ–Ω—Ç–µ–Ω—Ç–æ–º
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

![img.png](img/minio.png)

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç              | –û–ø–∏—Å–∞–Ω–∏–µ                  | –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞                                                                                                                                                                |
|------------------------|---------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Advertising-—Å–µ—Ä–≤–∏—Å** | –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å –Ω–∞ Go     | –í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≥–æ—Ä—É—Ç–∏–Ω –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏, –Ω–∏–∑–∫–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏                      |
| **PostgreSQL**         | –û—Å–Ω–æ–≤–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ        | ACID-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å, –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å, —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å, —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω–æ—Å—Ç—å, —Ä–∞–∑–≤–∏—Ç–∞—è —Å–∏—Å—Ç–µ–º–∞ –∏–Ω–¥–µ–∫—Å–æ–≤, –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è                                         |
| **ClickHouse**         | –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ   | –í—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, –∫–æ–ª–æ–Ω–æ—á–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö, –∫–æ–º–ø—Ä–µ—Å—Å–∏—è –¥–∞–Ω–Ω—ã—Ö, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏                    |
| **Redis**              | –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –±–¥ | –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã–º –¥–∞–Ω–Ω—ã–º, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö, –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è –∏ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å, –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏                                  |
| **MinIO**              | –•—Ä–∞–Ω–µ–Ω–∏–µ –º–µ–¥–∏–∞            | S3-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ, –≤—ã—Å–æ–∫–∞—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤, –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CDN, —É–¥–æ–±–Ω–∞—è –≤–µ–± –ø–∞–Ω–µ–ª—å           |
| **Grafana**            | –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è              | –ì–∏–±–∫–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –¥–∞—à–±–æ—Ä–¥–æ–≤, –±–æ–≥–∞—Ç—ã–π –Ω–∞–±–æ—Ä –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–π, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö (–≤ —Ç.—á ClickHouse), —Å–∏—Å—Ç–µ–º–∞ –∞–ª–µ—Ä—Ç–æ–≤, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–æ–ª–µ–≤–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ |

## ‚öôÔ∏è –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

### –ü–æ–¥–±–æ—Ä —Ä–µ–∫–ª–∞–º—ã

```mermaid
flowchart TD
   A[–ó–∞–ø—Ä–æ—Å –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è] --> B[–ü–æ–∏—Å–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏–π]
   B --> C{–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è}
   C -->|–ü–æ —Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥—É| D[–ü–æ–¥—Ö–æ–¥—è—â–∏–µ –ø–æ —Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥—É]
   C -->|–ü–æ –¥–∞—Ç–∞–º| E[–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ –¥–∞—Ç–∞–º]
   C -->|–ü–æ –º–æ–¥–µ—Ä–∞—Ü–∏–∏| F[–ü—Ä–æ—à–µ–¥—à–∏–µ –º–æ–¥–µ—Ä–∞—Ü–∏—é]
   D & E & F --> G[–ü–æ–¥—Å—á—ë—Ç —Å–∫–æ—Ä–æ–≤ –∫–∞–º–ø–∞–Ω–∏–π]
   G --> TH[–ü–æ–¥—Å—á—ë—Ç Threshold]
   TH --> gteBas{–ë–æ–ª—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ –±–∞–∑–æ–≤–æ–º—É?}
   gteBas -->|–î–∞| save[–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é TH]
   TH --> H{–°–∫–æ—Ä >= Threshold?}
   H -->|–ù–µ—Ç| I[–û—Ç—Å–µ–∏–≤–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è]
   H -->|–î–∞| J[–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤]
   J --> K[–í—ã–±–æ—Ä –æ–±—ä—è–≤–ª–µ–Ω–∏—è]
   K -->|–ö—Ä–∏—Ç–µ—Ä–∏–∏| L["1. –ú–∏–Ω. –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n2. –ú–∞–∫—Å. –°–∫–æ—Ä"]
   L --> M[–ó–∞–ø–∏—Å—å –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤ ClickHouse]
   M --> N[–í—ã–¥–∞—á–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏—è]
```

### –°–∫–æ—Ä–∏–Ω–≥ —Ä–µ–∫–ª–∞–º—ã

–°–∫–æ—Ä —Ä–µ–∫–ª–∞–º—ã —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ –≤–∑–≤–µ—à–µ–Ω–Ω–∞—è —Å—É–º–º–∞ —Ç—Ä–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

1. **–†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å (Relevance Score)**

   - ML-—Å–∫–æ—Ä —á–µ—Ä–µ–∑ —Å–∏–≥–º–æ–∏–¥: `1 / (1 + e^(-mlScore/1000))`
   - –í–µ—Å: `RelevanceWeight`

2. **–ü—Ä–∏–±—ã–ª—å (Profit Score)**

   - –§–æ—Ä–º—É–ª–∞: `CPI √ó –ü–æ–∫–∞–∑—ã + CPC √ó –ö–ª–∏–∫–∏ √ó (1 + –†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å)`
   - –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è: `1 / (1 + e^(-revenue/10000))`
   - –í–µ—Å: `PlatformProfitWeight`

3. **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (Performance Score)**
   - –û—Ü–µ–Ω–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –æ—Ç —Ü–µ–ª–µ–π
   - –ü–ª–∞–≤–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ –¥–æ 105% —Ü–µ–ª–∏
   - –†–µ–∑–∫–æ–µ –ø–∞–¥–µ–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–µ–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏
   - –í–µ—Å: `PerformanceWeight`

### Threshold

–ê–ª–≥–æ—Ä–∏—Ç–º –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –ø–æ—Ä–æ–≥–∞:

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏**

   - –ü—É—Å—Ç–∞—è –∏—Å—Ç–æ—Ä–∏—è ‚Üí –±–∞–∑–æ–≤—ã–π –ø–æ—Ä–æ–≥ (0.7)
   - –ò–Ω–∞—á–µ ‚Üí –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç

2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö**
   - –°–±–æ—Ä —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å–∫–æ—Ä–æ–≤
   - –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é
   - –í—ã—á–∏—Å–ª–µ–Ω–∏–µ 80-–≥–æ –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—è

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:

- –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ RLock
- –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–µ–π —á–µ—Ä–µ–∑ map
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏

### –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –∫–∞–º–ø–∞–Ω–∏—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ñ–∞–π–ª –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º.
–ó–∞—Ç–µ–º –æ–Ω–æ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ MinIO –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å—Å—ã–ª–∫–∞ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é. MinIO –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –ø—É–±–ª–∏—á–Ω–æ–µ —á—Ç–µ–Ω–∏–µ.

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è redis

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ –¥–ª—è —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –∫–∞–º–ø–∞–Ω–∏–π

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–æ–¥–µ–ª—å **Gigachat-lite**

`POST /ai/advertisers/:advertiserId/generate/ad-text`

```json
{
  "ad_title": "Amazing Offer",
  "additional_info": "–î–æ–±–∞–≤—å –≤ —Ç–µ–∫—Å—Ç –ú–ù–û–ì–û —ç–º–æ–¥–∑–∏"
}
```

–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç –¥–ª—è —Ä–µ–∫–ª–∞–º–Ω–æ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ).

–Ø–∑—ã–∫ —Ç–µ–∫—Å—Ç–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —è–∑—ã–∫–∞ —Ç–µ–∫—Å—Ç–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞. –ü–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –ø—Ä–æ–º–ø—Ç–∞ –ø–æ–ª—É—á–∞–µ—Ç—Å—è —è–∑—ã–∫ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∏ —è–≤–Ω–æ
—É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤ –ø—Ä–æ–º–ø—Ç–µ.

### ClickHouse

ClickHouse –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ –∏ –∫–ª–∏–∫–æ–≤ –æ–±—ä—è–≤–ª–µ–Ω–∏–π.
–ü—Ä–æ—Å–º–æ—Ç—Ä—ã –∏ –∫–ª–∏–∫–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ, –Ω–æ –Ω–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞—Ö –º–æ–∂–µ—Ç –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ç—å—Å—è view_count, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ, –Ω–æ
–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø–æ–¥–±–æ—Ä–µ.

## Note

```text
–ü—Ä–∏–≤–µ—Ç! –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–º–µ—Ç–æ—á–∫–∞ –æ—Ç –∞–≤—Ç–æ—Ä–∞

–ß—Ç–æ–∂, —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å –¥–∂–æ–±–æ–π —Ö–æ—Ç—å –∏ –±—ã–ª–∞ –æ—á–µ–Ω—å –∫–ª–∞—Å—Å–Ω–æ–π –∏ –Ω—Ä–∞–≤–∏–ª–∞—Å—å –º–Ω–µ, –Ω–æ –º–Ω–µ –ø—Ä–∏—à–ª–æ—Å—å –æ—Ç –Ω–µ–µ –æ—Ç–∫–∞–∑–∞—Ç—å—Å—è,
–í—Å–µ —á—Ç–æ –æ—Ç –Ω–µ–µ –æ—Å—Ç–∞–ª–æ—Å—å - —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ ad_scoring —Å–µ—Ä–≤–∏—Å–µ –∏ –≤ redis/ads –ø–∞–∫–µ—Ç–µ.
–ú–æ–∂–µ—à—å –∏–∑—É—á–∏—Ç—å –µ—Å–ª–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ)

–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ –ø—Ä–æ—à–ª–∞ –≤ —É—Å–ª–æ–≤–∏—è—Ö —Ç–µ—Å—Ç–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –∏ –º–Ω–µ –ø—Ä–∏—à–ª–æ—Å—å –ø—Ä–∏–π—Ç–∏ –∫ –±–æ–ª–µ–µ –ø—Ä–æ—Å—Ç–æ–º—É —Ä–µ—à–µ–Ω–∏—é,
–∫–æ—Ç–æ—Ä–æ–µ —è –Ω–µ —É—Å–ø–µ–ª –¥–æ–≤–µ—Å—Ç–∏ –¥–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ä–æ—à–∏—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π –∏–∑-–∑–∞ —Ç–æ–≥–æ —á—Ç–æ –ø–æ—Ç—Ä–∞—Ç–∏–ª –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –ø—Ä–æ—à–ª—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é
(–ê –µ—â–µ –Ω–∞ —Ç–æ —á—Ç–æ–±—ã —Ñ–∏–∫—Å–∏—Ç—å –æ—à–∏–±–∫—É –∫–æ—Ç–æ—Ä–æ–π –Ω–µ–±—ã–ª–æ :D)

–Ø –≤–ª–æ–∂–∏–ª –¥—É—à—É, –≤—Ä–µ–º—è, —Å–∏–ª—ã, –±–µ—Å—Å–æ–Ω–Ω—É—é –Ω–æ—á—å –∏ 2 –∫—Ä—É–∂–∫–∏ –∫–æ—Ñ–µ –≤ —ç—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç, –Ω–∞–¥–µ—é—Å—å —Ç–µ–±–µ –ø–æ–Ω—Ä–∞–≤–∏—Ç—Å—è)
–í –ø—Ä–æ–µ–∫—Ç–µ –µ—Å—Ç—å –∑–∞–¥–µ–ª –ø–æ–¥ —Ç–µ–ª–µ–≥—Ä–∞–º–º –±–æ—Ç–∞, –Ω–æ –¥–∞–ª—å—à–µ –∑–∞–¥–µ–ª–∞ –¥–µ–ª–æ –Ω–µ —É—à–ª–æ)
```
